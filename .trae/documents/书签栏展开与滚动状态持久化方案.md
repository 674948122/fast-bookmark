## 目标
- 将书签栏的目录展开状态与滚动位置做持久化，保证在所有网页和所有标签页打开时状态一致。
- 默认沿用当前初始展开（'1','2'）；如有历史记录则优先恢复历史。

## 存储与消息通道
- 存储位置：chrome.storage.local，键名 sidebarState（包含 expandedFolders: string[]、scrollTop: number）。
- 消息类型：
  - getSidebarState：内容脚本请求当前持久化状态
  - saveSidebarState：内容脚本写入最新状态
- 参考现有消息与存储模式：[background.js](file:///Users/pandegong/my-project/fast-bookmark/background.js#L108-L145)

## 内容脚本改动（content.js）
- 初始化恢复：
  - 在首次显示侧栏时（toggle(true)分支内）请求 getSidebarState 并将 expandedFolders 设置为返回值；渲染完成后设置 resultsList.scrollTop。
  - 渲染入口位置：在 renderResults 完成树视图渲染后应用滚动恢复。
  - 相关入口与元素：
    - 侧栏开关：[toggle](file:///Users/pandegong/my-project/fast-bookmark/content.js#L640-L668)
    - 树视图渲染：[renderTreeView](file:///Users/pandegong/my-project/fast-bookmark/content.js#L446-L454)、[renderNode](file:///Users/pandegong/my-project/fast-bookmark/content.js#L455-L538)
    - 列表容器：resultsList（ul，overflow-y: auto）[content.js](file:///Users/pandegong/my-project/fast-bookmark/content.js#L151-L157)
- 变更监听与持久化：
  - 展开/收起文件夹：在 itemEl 点击（isFolder 分支）更新 expandedFolders 后，调用 saveSidebarState（防抖 200ms）。位置：[content.js](file:///Users/pandegong/my-project/fast-bookmark/content.js#L508-L515)
  - 滚动位置：为 resultsList 添加 scroll 事件，使用节流（200ms）写入最新 scrollTop。
  - 保存内容：{ expandedFolders: Array.from(expandedFolders), scrollTop: resultsList.scrollTop }
- 搜索态处理：
  - 仅在非搜索态（container.classList 不含 'searching'）时参与滚动持久化与恢复，避免搜索列表影响树视图滚动。

## 背景脚本改动（background.js）
- 增加消息处理：
  - getSidebarState：chrome.storage.local.get(['sidebarState']) 并返回默认值 { expandedFolders:['1','2'], scrollTop: 0 }。
  - saveSidebarState：chrome.storage.local.set({ sidebarState })；无需广播。
- 保持与现有 recentBookmarks 的写入方式一致，以降低维护成本。

## 状态应用时机与冲突处理
- 应用顺序：获取书签 → 渲染树 → 应用 expandedFolders → 设置 scrollTop。
- 书签结构变化：如果某些历史展开 ID 在最新树中不存在，跳过即可；不抛错。
- 默认值策略：无历史时使用 ['1','2'] 与 0。

## 验证方案
- 在两个不同网页打开侧栏，展开若干目录并下滚；关闭后在另一网页再次打开，确认展开与滚动位置一致。
- 切换搜索与非搜索态，确认仅树视图滚动被持久化；搜索结果滚动不影响树视图。
- 修改书签结构（新增/删除文件夹）后，确认恢复逻辑稳定，无报错。

## 采纳后执行步骤
- 在 background.js 添加 getSidebarState/saveSidebarState 的消息分支与 chrome.storage.local 读写。
- 在 content.js：
  - 首次显示时请求并应用状态；
  - 为展开切换与滚动添加持久化（防抖/节流）；
  - 在 renderResults 树视图完成后应用滚动恢复。
- 自测并在多个标签页验证一致性。